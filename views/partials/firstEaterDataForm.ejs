<div id="regForm" action="">

    <!-- One "tab" for each step in the form: -->
    <div class="tab">กำหนดรูปโปรไฟล์ของคุณ:
        <div class="form-section section-1">
            <img class="file-path validate eaterpic" onerror="this.onerror=null;this.src='/assets/images/avatar-default.png';">
            <div class="input-group mb-3">
                <div class="custom-file">
                    <input type="file" class="custom-file-input" id="photoInput" name="myImage" style='width:100%;margin: 10px auto;'>
                    <label class="custom-file-label" for="photoInput">Choose file</label>
                </div>
                <div class="input-group-append">
                    <span class="input-group-text" id="sendPhoto">Upload</span>
                </div>
            </div>
        </div>
        <h6 id="step-instruction">กรุณาระบุข้อมูลส่วนตัวของคุณเพื่อตั้งค่าบัญชีผู้ใช้ เพื่อเข้าใช้งานเป็นครั้งแรก</h6>
    </div>

    <div class="tab">ข้อมูลการชำระเงิน:
        <div class="">
        <!-- <form action="/eaterDataForm" method="post" enctype="multipart/form-data"> -->
            <form id="eaterDataForm" action="/eaterDataForm" method="post" >
                <div class='form-group'>
                    <label for="eater-card">Credit / Debit Card Number</label>
                    <input style="font-family: 'Kanit';" type="number" class="form-control" id="eater-card" placeholder="Your Card Number" name="Cardnumber">
                </div>
                <div class='form-group'>
                    <label for="eater-card-holder">Holder Name</label>
                    <input style="font-family: 'Kanit';" type="text" class="form-control" id="eater-card-holder" placeholder="Your Card Holder Name" name="CardName">
                </div>
                <div class="form-group">
                    <label for="expireDate">Expiration</label>
                    <div class='row'>
                        <select id="expireDate" class="form-control col-md-5" name="expireMonth" required>
                            <option selected >Month</option>
                            <%for(let i=1;i<=12;i++){%>
                            <option value=<%-i%>><%- i%></option>
                            <%}%>
                        </select>
                        <select class="form-control col-md-7" name="expireYear" required>
                            <option selected>Year</option>
                            <%for(let i=2018;i<=2030;i++){%>
                            <option value=<%-i%>><%- i%></option>
                            <%}%>
                        </select>
                    </div>
                    <label style="padding-top: 10px;" >CVV</label> 
                    <input style="font-family: 'Kanit';" type="number" class="form-control" placeholder="CVV" name="CVV">
                </div>
        </div>
    </div>

    <div class="tab">ข้อมูลส่วนตัว:
        <div class="">
            <div class="form-group" style="padding: 0 15px;">
                <label for="firstname">Fullname</label>
                <div class="row">
                    <div class="col-md-6">
                            <input type="text" id='firstname'pattern="[A-Za-z]" class="form-control" placeholder="First name" name="firstname">
                        </div>
                        <div class="col-md-6">
                            <input type="text" class="form-control" pattern="[A-Za-z]" placeholder="Last name" name="lastname">
                    </div>
                </div>
            </div>
            <div class='form-group' style="padding: 0 15px;">
                <label for="eater-phone">Phone Number</label>
                <input style="width:50%" type="number" class="form-control" id="eater-phone" placeholder="e.g.0123456789" name="phone">
            </div>
            <div class="form-group">
                <div class='row'>
                    <div class="col-md-4">
                        <label style="color:#00ff89; margin-top:10px;" for="gender" >Gender</label>
                        <select class="form-control" id="gender"name="gender" required>
                            <option selected>Select</option>
                            <option value="male">Male</option>
                            <option value="female">Female</option>
                            <option value="other">Other</option>
                        </select>
                    </div>

                    <div class="col-md-8">
                        <label style="color:#00ff89; margin-top:10px;" for="birth">Birthday</label>
                        <input type="date" name="birthDay" id="birth" class="form-control" name="birthDay" >
                    </div>
                </div>
            </div>
            
        </div>
    </div>

    <div class="tab">ที่อยู่:
        <div class='form-group'>
            <label for="eater-address">Address</label>
            <textarea class="form-control" id="eater-address" style="height: 120px;" placeholder="Your Address" name="ADDRESS" required></textarea>
        </div>
        <div class='form-group'>
            <label for="eater-billing">Billing Address</label>
            <textarea class="form-control" id="eater-billing" placeholder="Your Billing Address" name="BillingAddress" required></textarea>
        </div>
    </div>
        </form>

    <div style="overflow:auto;">
        <div style="float:right;">
            <button type="button" id="prevBtn" onclick="nextPrev(-1)">Previous</button>
            <button type="button" id="nextBtn" onclick="nextPrev(1)">Next</button>
        </div>
    </div>

    <!-- Circles which indicates the steps of the form: -->
    <div style="text-align:center;margin-top:40px;">
    <span class="step"></span>
    <span class="step"></span>
    <span class="step"></span>
    <span class="step"></span>
    </div>

</div>

<script>
    const uploadFile = (requestObj, callback) => {
        $('#'+requestObj.triggerElementId).on('click', () => {
            let formData =new FormData();
            let fileInputElement = document.getElementById(requestObj.inputElementId);
            formData.append('fileUpload', fileInputElement.files[0]);
            $.ajax({
                url: requestObj.route+'?'+'fileName='+requestObj.fileNameWithFormat+'&filePath='+requestObj.path,
                type: 'POST',
                async: false,
                processData: false,
                contentType: false,
                data: formData,
                success: function(data, status){
                    callback(data);
                },
                error: function(err){
                    console.log(err);
                },
                complete: function(){
                    console.log('complete');
                }
            });
        });
    }

    let myRequest = {
        route: '/upload',
        triggerElementId: 'sendPhoto', //ไม่ต้องใส่ #
        inputElementId: 'photoInput',
        path: './userSrc/photos/',
        fileNameWithFormat: 'myExample2.jpg'
    }
    
    $('.eaterpic').attr('src','http://'+ $(location).attr('host') + '/photos/'+user._id+'/avatar/'+user._id+'.jpg' + "?timestamp="  + new Date().getTime());
    
    // var hostName =$(location).attr('protocol')+'://'+$(location).attr('hostname')+'/photos/'+req.user._id+'/avatar/'+req.user._id+'.jpg'


    uploadFile(myRequest, (data) => {
        // fuunction รับ data กลับ
        $('.eaterpic').attr('src','');
        $('.eaterpic').attr('src','http://'+ $(location).attr('host') + data + "?timestamp="  + new Date().getTime());
    });

    var currentTab = 0; // Current tab is set to be the first tab (0)
    showTab(currentTab); // Display the current tab

    function showTab(n) {
    // This function will display the specified tab of the form ...
    var x = document.getElementsByClassName("tab");
    x[n].style.display = "block";
    // ... and fix the Previous/Next buttons:
    if (n == 0) {
        document.getElementById("prevBtn").style.display = "none";
    } else {
        document.getElementById("prevBtn").style.display = "inline";
    }
    if (n == (x.length - 1)) {
        document.getElementById("nextBtn").innerHTML = "Submit";
    } else {
        document.getElementById("nextBtn").innerHTML = "Next";
    }
    // ... and run a function that displays the correct step indicator:
    fixStepIndicator(n)
    }

    function nextPrev(n) {
    // This function will figure out which tab to display
    var x = document.getElementsByClassName("tab");
    // Exit the function if any field in the current tab is invalid:
    if (n == 1 && !validateForm()) return false;
    // Hide the current tab:
    x[currentTab].style.display = "none";
    // Increase or decrease the current tab by 1:
    currentTab = currentTab + n;
    // if you have reached the end of the form... :
    if (currentTab >= x.length) {
        //...the form gets submitted:
        $('#eaterDataForm').get(0).submit();
        
        return false;
    }
    // Otherwise, display the correct tab:
    showTab(currentTab);
    }

    function validateForm() {
    // This function deals with validation of the form fields
    var x, y, i, valid = true;
    x = document.getElementsByClassName("tab");
    y = x[currentTab].getElementsByTagName("input");
    // A loop that checks every input field in the current tab:
    for (i = 0; i < y.length; i++) {
        // If a field is empty...
        if (y[i].value == "") {
        // add an "invalid" class to the field:
        y[i].className += " invalid";
        // and set the current valid status to false:
        valid = false;
        }
    }
    // If the valid status is true, mark the step as finished and valid:
    if (valid) {
        document.getElementsByClassName("step")[currentTab].className += " finish";
    }
    return valid; // return the valid status
    }

    function fixStepIndicator(n) {
    // This function removes the "active" class of all steps...
    var i, x = document.getElementsByClassName("step");
    for (i = 0; i < x.length; i++) {
        x[i].className = x[i].className.replace(" active", "");
    }
    //... and adds the "active" class to the current step:
    x[n].className += " active";
    }
</script>